"use strict";

var _express = _interopRequireDefault(require("express"));

var _logger = _interopRequireDefault(require("logger"));

var _bcryptjs = _interopRequireDefault(require("bcryptjs"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

/* eslint-disable consistent-return */

/* eslint-disable no-underscore-dangle */
var log = _logger["default"].createLogger('./development.log');

var router = _express["default"].Router();

var _require = require('express-validator'),
    check = _require.check,
    validationResult = _require.validationResult,
    body = _require.body;

var _require2 = require('express-validator'),
    sanitizeBody = _require2.sanitizeBody;

var _response = require('../helpers/response');

var db = require('../config/db');

var Utils = require('../helpers/utils');

var authCheck = require('../middlewares/auth_check');

var salt = _bcryptjs["default"].genSaltSync(10); // create a new user


router.post('/signup', [check('email').exists().withMessage('Email is required'), check('password').exists().withMessage('Password is required'), check('first_name').exists().withMessage('First name is required'), check('last_name').exists().withMessage('Last name is required'), body('email').not().isEmpty().escape().isEmail(), sanitizeBody('email').normalizeEmail().trim()], function (req, res) {
  var errors = validationResult(req);

  if (!errors.isEmpty()) {
    res.status(404).json(_response.error(errors));
  } // logger.info({ errors, msg: 'User auth validation' });


  var _req$body = req.body,
      email = _req$body.email,
      password = _req$body.password,
      first_name = _req$body.first_name,
      last_name = _req$body.last_name;
  var isAdmin = true;
  var searchQuery = "SELECT * FROM users WHERE email = '".concat(email, "' ");
  db.query(searchQuery).then(function (resp) {
    if (resp.rowCount > 0) {
      res.status(403).json(_response.error('Email already exists'));
    } else {
      // find users
      db.query('SELECT * FROM users').then(function (users) {
        if (users.rowCount > 0) {
          isAdmin = false;
        }

        _bcryptjs["default"].hash(password, salt).then(function (hash) {
          var uniqui = Utils.randomString(200);
          var query = {
            text: 'INSERT INTO users(user_id,first_name,last_name,email,password,is_admin,address) VALUES($1,$2,$3,$4,$5,$6,$7) RETURNING *',
            values: [uniqui.trimRight(), first_name, last_name, email, hash, isAdmin, 'somewhere']
          };
          db.query(query).then(function (respo) {
            var jwtdata = {
              email: respo.rows[0].email,
              user_id: respo.rows[0].user_id,
              is_admin: respo.rows[0].is_admin,
              id: respo.rows[0].user_id
            };
            var token = Utils.signToken(jwtdata);
            var data = {
              user_id: respo.rows[0].user_id,
              is_admin: respo.rows[0].is_admin,
              id: respo.rows[0].user_id,
              token: token
            };
            console.log("Created ".concat(JSON.stringify(data)));
            res.status(201).json(_response.success(data));
          })["catch"](function (e) {
            return e;
          })["catch"](function (e) {
            log.error(e);
            res.status(500).json(_response.error('Something went wrong'));
          });
        })["catch"](function (err) {
          return res.status(500).json(_response.error(err));
        }); // log.info(isAdmin);

      })["catch"](function (err) {
        log.error(err);
        res.status(505).json(_response.error('Could not fetch users'));
      }); // end find users
    }
  })["catch"](function (err) {
    res.json(_response.error(err));
  }); // res.send(response.error('Something went wrong'))
}).post('/signin', [body('email').not().isEmpty().escape().isEmail(), body('password').not().isEmpty(), check('email').exists().withMessage('Email is required'), check('password').exists().withMessage('Password is required')], function (req, res) {
  var errors = validationResult(req);

  if (!errors.isEmpty()) {
    return res.status(403).send(_response.error(errors));
  }

  var _req$body2 = req.body,
      email = _req$body2.email,
      password = _req$body2.password;
  var searchQuery = "SELECT * FROM users WHERE email = '".concat(email.toLowerCase(), "'");
  db.query(searchQuery).then(function (resp) {
    if (resp.rowCount <= 0) {
      console.log("Email does not exist,check ".concat(email));
      return res.status(402).json(_response.error('Email does not exist'));
    }

    _bcryptjs["default"].compare(password ? password.toLowerCase() : null, resp.rows[0].password).then(function (respo) {
      if (respo !== true) {
        return res.status(403).json(_response.error('Passwords do not match'));
      }

      var jwtdata = {
        email: resp.rows[0].email,
        user_id: resp.rows[0].user_id,
        is_admin: resp.rows[0].is_admin,
        id: resp.rows[0].user_id
      };
      var token = Utils.signToken(jwtdata);
      req.headers.authorization = "Bearer ".concat(token);
      var data = {
        user_id: resp.rows[0].user_id,
        is_admin: resp.rows[0].is_admin,
        id: resp.rows[0].user_id,
        token: token
      };
      res.status(200).json(_response.success(data));
    })["catch"](function (err) {
      log.error("Bycrypt error ".concat(err));
      return res.status(500).json(_response.error('Failed to compare passwords'));
    });
  });
}).post('/admin/:user_id', authCheck, function (req, res) {
  // make user an admin
  var toBeAdmin = req.params.user_id;
  var data = req.decoded.data;
  var admin = data.is_admin; // log.info(admin);

  if (admin) {
    db.query("SELECT * FROM users WHERE user_id = '".concat(toBeAdmin, "' AND is_admin='", false, "'")).then(function (resp) {
      if (resp.rowCount > 0) {
        db.query("UPDATE users SET is_admin='".concat(true, "' WHERE user_id = '", toBeAdmin, "' RETURNING *")).then(function (newAdminData) {
          if (newAdminData.rowCount > 0) {
            res.status(200).json(_response.success(newAdminData.rows[0]));
          } else {
            res.status(500).json(_response.error('Failed to assign role'));
          }
        })["catch"](function () {
          res.status(401).json(_response.error('Opps! Something went wrong'));
        });
      } else {
        res.status(403).json(_response.error('Cannot re-assign role to user'));
      }
    })["catch"](function () {
      res.status(401).json(_response.error('Opps! Something went wrong'));
    });
  } else {
    res.status(505).json(_response.error('Your plans failed, we have a stronger algorithm'));
  }
});
module.exports = router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2FwcC9jb250cm9sbGVycy91c2VyLmpzIl0sIm5hbWVzIjpbImxvZyIsImxvZ2dlciIsImNyZWF0ZUxvZ2dlciIsInJvdXRlciIsImV4cHJlc3MiLCJSb3V0ZXIiLCJyZXF1aXJlIiwiY2hlY2siLCJ2YWxpZGF0aW9uUmVzdWx0IiwiYm9keSIsInNhbml0aXplQm9keSIsIl9yZXNwb25zZSIsImRiIiwiVXRpbHMiLCJhdXRoQ2hlY2siLCJzYWx0IiwiYmNyeXB0IiwiZ2VuU2FsdFN5bmMiLCJwb3N0IiwiZXhpc3RzIiwid2l0aE1lc3NhZ2UiLCJub3QiLCJpc0VtcHR5IiwiZXNjYXBlIiwiaXNFbWFpbCIsIm5vcm1hbGl6ZUVtYWlsIiwidHJpbSIsInJlcSIsInJlcyIsImVycm9ycyIsInN0YXR1cyIsImpzb24iLCJlcnJvciIsImVtYWlsIiwicGFzc3dvcmQiLCJmaXJzdF9uYW1lIiwibGFzdF9uYW1lIiwiaXNBZG1pbiIsInNlYXJjaFF1ZXJ5IiwicXVlcnkiLCJ0aGVuIiwicmVzcCIsInJvd0NvdW50IiwidXNlcnMiLCJoYXNoIiwidW5pcXVpIiwicmFuZG9tU3RyaW5nIiwidGV4dCIsInZhbHVlcyIsInRyaW1SaWdodCIsInJlc3BvIiwiand0ZGF0YSIsInJvd3MiLCJ1c2VyX2lkIiwiaXNfYWRtaW4iLCJpZCIsInRva2VuIiwic2lnblRva2VuIiwiZGF0YSIsImNvbnNvbGUiLCJKU09OIiwic3RyaW5naWZ5Iiwic3VjY2VzcyIsImUiLCJlcnIiLCJzZW5kIiwidG9Mb3dlckNhc2UiLCJjb21wYXJlIiwiaGVhZGVycyIsImF1dGhvcml6YXRpb24iLCJ0b0JlQWRtaW4iLCJwYXJhbXMiLCJkZWNvZGVkIiwiYWRtaW4iLCJuZXdBZG1pbkRhdGEiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOztBQUVBOztBQUNBOztBQUNBOzs7O0FBSkE7O0FBQ0E7QUFLQSxJQUFNQSxHQUFHLEdBQUdDLG1CQUFPQyxZQUFQLENBQW9CLG1CQUFw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QmQsWUFBQUEsR0FBRyxDQUFDRSxNQUFKLENBQVcsR0FBWCxFQUFnQkMsSUFBaEIsQ0FBcUJwQixTQUFTLENBQUNtRCxPQUFWLENBQWtCWSxZQUFZLENBQUN0QixJQUFiLENBQWtCLENBQWxCLENBQWxCLENBQXJCO0FBQ0QsV0FGRCxNQUVPO0FBQ0x4QixZQUFBQSxHQUFHLENBQUNFLE1BQUosQ0FBVyxHQUFYLEVBQWdCQyxJQUFoQixDQUFxQnBCLFNBQVMsQ0FBQ3FCLEtBQVYsQ0FBZ0IsdUJBQWhCLENBQXJCO0FBQ0Q7QUFDRixTQU5ELFdBTVMsWUFBTTtBQUNiSixVQUFBQSxHQUFHLENBQUNFLE1BQUosQ0FBVyxHQUFYLEVBQWdCQyxJQUFoQixDQUFxQnBCLFNBQVMsQ0FBQ3FCLEtBQVYsQ0FBZ0IsNEJBQWhCLENBQXJCO0FBQ0QsU0FSRDtBQVNELE9BVkQsTUFVTztBQUNMSixRQUFBQSxHQUFHLENBQUNFLE1BQUosQ0FBVyxHQUFYLEVBQWdCQyxJQUFoQixDQUFxQnBCLFNBQVMsQ0FBQ3FCLEtBQVYsQ0FBZ0IsK0JBQWhCLENBQXJCO0FBQ0Q7QUFDRixLQWRELFdBY1MsWUFBTTtBQUNiSixNQUFBQSxHQUFHLENBQUNFLE1BQUosQ0FBVyxHQUFYLEVBQWdCQyxJQUFoQixDQUFxQnBCLFNBQVMsQ0FBQ3FCLEtBQVYsQ0FBZ0IsNEJBQWhCLENBQXJCO0FBQ0QsS0FoQkQ7QUFpQkQsR0FsQkQsTUFrQk87QUFDTEosSUFBQUEsR0FBRyxDQUFDRSxNQUFKLENBQVcsR0FBWCxFQUFnQkMsSUFBaEIsQ0FBcUJwQixTQUFTLENBQUNxQixLQUFWLENBQWdCLGlEQUFoQixDQUFyQjtBQUNEO0FBQ0YsQ0E3SkQ7QUErSkEyQyxNQUFNLENBQUNDLE9BQVAsR0FBaUJ6RSxNQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIGNvbnNpc3RlbnQtcmV0dXJuICovXG4vKiBlc2xpbnQtZGlzYWJsZSBuby11bmRlcnNjb3JlLWRhbmdsZSAqL1xuaW1wb3J0IGV4cHJlc3MgZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgbG9nZ2VyIGZyb20gJ2xvZ2dlcic7XG5pbXBvcnQgYmNyeXB0IGZyb20gJ2JjcnlwdGpzJztcblxuY29uc3QgbG9nID0gbG9nZ2VyLmNyZWF0ZUxvZ2dlcignLi9kZXZlbG9wbWVudC5sb2cnKTtcblxuY29uc3Qgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcbmNvbnN0IHtcbiAgY2hlY2ssXG4gIHZhbGlkYXRpb25SZXN1bHQsIGJvZHksXG59ID0gcmVxdWlyZSgnZXhwcmVzcy12YWxpZGF0b3InKTtcblxuY29uc3Qge1xuICBzYW5pdGl6ZUJvZHksXG59ID0gcmVxdWlyZSgnZXhwcmVzcy12YWxpZGF0b3InKTtcbmNvbnN0IF9yZXNwb25zZSA9IHJlcXVpcmUoJy4uL2hlbHBlcnMvcmVzcG9uc2UnKTtcbmNvbnN0IGRiID0gcmVxdWlyZSgnLi4vY29uZmlnL2RiJyk7XG5jb25zdCBVdGlscyA9IHJlcXVpcmUoJy4uL2hlbHBlcnMvdXRpbHMnKTtcbmNvbnN0IGF1dGhDaGVjayA9IHJlcXVpcmUoJy4uL21pZGRsZXdhcmVzL2F1dGhfY2hlY2snKTtcblxuY29uc3Qgc2FsdCA9IGJjcnlwdC5nZW5TYWx0U3luYygxMCk7XG4vLyBjcmVhdGUgYSBuZXcgdXNlclxucm91dGVyLnBvc3QoJy9zaWdudXAnLFxuICBbXG4gICAgY2hlY2soJ2VtYWlsJykuZXhpc3RzKCkud2l0aE1lc3NhZ2UoJ0VtYWlsIGlzIHJlcXVpcmVkJyksXG4gICAgY2hlY2soJ3Bhc3N3b3JkJykuZXhpc3RzKCkud2l0aE1lc3NhZ2UoJ1Bhc3N3b3JkIGlzIHJlcXVpcmVkJyksXG4gICAgY2hlY2soJ2ZpcnN0X25hbWUnKS5leGlzdHMoKS53aXRoTWVzc2FnZSgnRmlyc3QgbmFtZSBpcyByZXF1aXJlZCcpLFxuICAgIGNoZWNrKCdsYXN0X25hbWUnKS5leGlzdHMoKS53aXRoTWVzc2FnZSgnTGFzdCBuYW1lIGlzIHJlcXVpcmVkJyksXG4gICAgYm9keSgnZW1haWwnKS5ub3QoKS5pc0VtcHR5KCkuZXNjYXBlKClcbiAgICAgIC5pc0VtYWlsKCksXG4gICAgc2FuaXRpemVCb2R5KCdlbWFpbCcpLm5vcm1hbGl6ZUVtYWlsKCkudHJpbSgpLFxuICBdLCAocmVxLCByZXMpID0+IHtcbiAgICBjb25zdCBlcnJvcnMgPSB2YWxpZGF0aW9uUmVzdWx0KHJlcSk7XG4gICAgaWYgKCFlcnJvcnMuaXNFbXB0eSgpKSB7XG4gICAgICByZXMuc3RhdHVzKDQwNCkuanNvbihfcmVzcG9uc2UuZXJyb3IoZXJyb3JzKSk7XG4gICAgfVxuICAgIC8vIGxvZ2dlci5pbmZvKHsgZXJyb3JzLCBtc2c6ICdVc2VyIGF1dGggdmFsaWRhdGlvbicgfSk7XG4gICAgY29uc3Qge1xuICAgICAgZW1haWwsXG4gICAgICBwYXNzd29yZCxcbiAgICAgIGZpcnN0X25hbWUsXG4gICAgICBsYXN0X25hbWUsXG4gICAgfSA9IHJlcS5ib2R5O1xuICAgIGxldCBpc0FkbWluID0gdHJ1ZTtcbiAgICBjb25zdCBzZWFyY2hRdWVyeSA9IGBTRUxFQ1QgKiBGUk9NIHVzZXJzIFdIRVJFIGVtYWlsID0gJyR7ZW1haWx9JyBgO1xuXG4gICAgZGIucXVlcnkoc2VhcmNoUXVlcnkpLnRoZW4oKHJlc3ApID0+IHtcbiAgICAgIGlmIChyZXNwLnJvd0NvdW50ID4gMCkge1xuICAgICAgICByZXMuc3RhdHVzKDQwMykuanNvbihfcmVzcG9uc2UuZXJyb3IoJ0VtYWlsIGFscmVhZHkgZXhpc3RzJykpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gZmluZCB1c2Vyc1xuICAgICAgICBkYi5xdWVyeSgnU0VMRUNUICogRlJPTSB1c2VycycpLnRoZW4oKHVzZXJzKSA9PiB7XG4gICAgICAgICAgaWYgKHVzZXJzLnJvd0NvdW50ID4gMCkge1xuICAgICAgICAgICAgaXNBZG1pbiA9IGZhbHNlO1xuICAgICAgICAgIH1cblxuXG4gICAgICAgICAgYmNyeXB0Lmhhc2gocGFzc3dvcmQsIHNhbHQpLnRoZW4oKGhhc2gpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHVuaXF1aSA9IFV0aWxzLnJhbmRvbVN0cmluZygyMDApO1xuICAgICAgICAgICAgY29uc3QgcXVlcnkgPSB7XG4gICAgICAgICAgICAgIHRleHQ6ICdJTlNFUlQgSU5UTyB1c2Vycyh1c2VyX2lkLGZpcnN0X25hbWUsbGFzdF9uYW1lLGVtYWlsLHBhc3N3b3JkLGlzX2FkbWluLGFkZHJlc3MpIFZBTFVFUygkMSwkMiwkMywkNCwkNSwkNiwkNykgUkVUVVJOSU5HIConLFxuICAgICAgICAgICAgICB2YWx1ZXM6IFt1bmlxdWkudHJpbVJpZ2h0KCksIGZpcnN0X25hbWUsIGxhc3RfbmFtZSwgZW1haWwsIGhhc2gsIGlzQWRtaW4sICdzb21ld2hlcmUnXSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBkYi5xdWVyeShxdWVyeSlcbiAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3Qgand0ZGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgIGVtYWlsOiByZXNwby5yb3dzWzBdLmVtYWlsLFxuICAgICAgICAgICAgICAgICAgdXNlcl9pZDogcmVzcG8ucm93c1swXS51c2VyX2lkLFxuICAgICAgICAgICAgICAgICAgaXNfYWRtaW46IHJlc3BvLnJvd3NbMF0uaXNfYWRtaW4sXG4gICAgICAgICAgICAgICAgICBpZDogcmVzcG8ucm93c1swXS51c2VyX2lkLFxuXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjb25zdCB0b2tlbiA9IFV0aWxzLnNpZ25Ub2tlbihqd3RkYXRhKTtcbiAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0ge1xuICAgICAgICAgICAgICAgICAgdXNlcl9pZDogcmVzcG8ucm93c1swXS51c2VyX2lkLFxuICAgICAgICAgICAgICAgICAgaXNfYWRtaW46IHJlc3BvLnJvd3NbMF0uaXNfYWRtaW4sXG4gICAgICAgICAgICAgICAgICBpZDogcmVzcG8ucm93c1swXS51c2VyX2lkLFxuICAgICAgICAgICAgICAgICAgdG9rZW4sXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgQ3JlYXRlZCAke0pTT04uc3RyaW5naWZ5KGRhdGEpfWApO1xuICAgICAgICAgICAgICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKF9yZXNwb25zZS5zdWNjZXNzKGRhdGEpKTtcbiAgICAgICAgICAgICAgfSkuY2F0Y2goKGUpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZTtcbiAgICAgICAgICAgICAgfSkuY2F0Y2goKGUpID0+IHtcbiAgICAgICAgICAgICAgICBsb2cuZXJyb3IoZSk7XG4gICAgICAgICAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oX3Jlc3BvbnNlLmVycm9yKCdTb21ldGhpbmcgd2VudCB3cm9uZycpKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKF9yZXNwb25zZS5lcnJvcihlcnIpKTtcbiAgICAgICAgICB9KTtcblxuXG4gICAgICAgICAgLy8gbG9nLmluZm8oaXNBZG1pbik7XG4gICAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICBsb2cuZXJyb3IoZXJyKTtcbiAgICAgICAgICByZXMuc3RhdHVzKDUwNSkuanNvbihfcmVzcG9uc2UuZXJyb3IoJ0NvdWxkIG5vdCBmZXRjaCB1c2VycycpKTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIGVuZCBmaW5kIHVzZXJzXG4gICAgICB9XG4gICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgcmVzLmpzb24oX3Jlc3BvbnNlLmVycm9yKGVycikpO1xuICAgIH0pO1xuXG5cbiAgICAvLyByZXMuc2VuZChyZXNwb25zZS5lcnJvcignU29tZXRoaW5nIHdlbnQgd3JvbmcnKSlcbiAgfSkucG9zdCgnL3NpZ25pbicsIFtib2R5KCdlbWFpbCcpLm5vdCgpLmlzRW1wdHkoKS5lc2NhcGUoKVxuICAuaXNFbWFpbCgpLFxuYm9keSgncGFzc3dvcmQnKS5ub3QoKS5pc0VtcHR5KCksXG5jaGVjaygnZW1haWwnKS5leGlzdHMoKS53aXRoTWVzc2FnZSgnRW1haWwgaXMgcmVxdWlyZWQnKSxcbmNoZWNrKCdwYXNzd29yZCcpLmV4aXN0cygpLndpdGhNZXNzYWdlKCdQYXNzd29yZCBpcyByZXF1aXJlZCcpXSxcbihyZXEsIHJlcykgPT4ge1xuICBjb25zdCBlcnJvcnMgPSB2YWxpZGF0aW9uUmVzdWx0KHJlcSk7XG4gIGlmICghZXJyb3JzLmlzRW1wdHkoKSkge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuc2VuZChfcmVzcG9uc2UuZXJyb3IoZXJyb3JzKSk7XG4gIH1cbiAgY29uc3Qge1xuICAgIGVtYWlsLFxuICAgIHBhc3N3b3JkLFxuICB9ID0gcmVxLmJvZHk7XG4gIGNvbnN0IHNlYXJjaFF1ZXJ5ID0gYFNFTEVDVCAqIEZST00gdXNlcnMgV0hFUkUgZW1haWwgPSAnJHtlbWFpbC50b0xvd2VyQ2FzZSgpfSdgO1xuXG4gIGRiLnF1ZXJ5KHNlYXJjaFF1ZXJ5KS50aGVuKChyZXNwKSA9PiB7XG4gICAgaWYgKHJlc3Aucm93Q291bnQgPD0gMCkge1xuICAgICAgY29uc29sZS5sb2coYEVtYWlsIGRvZXMgbm90IGV4aXN0LGNoZWNrICR7ZW1haWx9YCk7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDIpLmpzb24oX3Jlc3BvbnNlLmVycm9yKCdFbWFpbCBkb2VzIG5vdCBleGlzdCcpKTtcbiAgICB9XG5cbiAgICBiY3J5cHQuY29tcGFyZShwYXNzd29yZCA/IHBhc3N3b3JkLnRvTG93ZXJDYXNlKCkgOiBudWxsLCByZXNwLnJvd3NbMF0ucGFzc3dvcmQpLnRoZW4oKHJlc3BvKSA9PiB7XG4gICAgICBpZiAocmVzcG8gIT09IHRydWUpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKF9yZXNwb25zZS5lcnJvcignUGFzc3dvcmRzIGRvIG5vdCBtYXRjaCcpKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGp3dGRhdGEgPSB7XG4gICAgICAgIGVtYWlsOiByZXNwLnJvd3NbMF0uZW1haWwsXG4gICAgICAgIHVzZXJfaWQ6IHJlc3Aucm93c1swXS51c2VyX2lkLFxuICAgICAgICBpc19hZG1pbjogcmVzcC5yb3dzWzBdLmlzX2FkbWluLFxuICAgICAgICBpZDogcmVzcC5yb3dzWzBdLnVzZXJfaWQsXG4gICAgICB9O1xuICAgICAgY29uc3QgdG9rZW4gPSBVdGlscy5zaWduVG9rZW4oand0ZGF0YSk7XG4gICAgICByZXEuaGVhZGVycy5hdXRob3JpemF0aW9uID0gYEJlYXJlciAke3Rva2VufWA7XG4gICAgICBjb25zdCBkYXRhID0ge1xuICAgICAgICB1c2VyX2lkOiByZXNwLnJvd3NbMF0udXNlcl9pZCxcbiAgICAgICAgaXNfYWRtaW46IHJlc3Aucm93c1swXS5pc19hZG1pbixcbiAgICAgICAgaWQ6IHJlc3Aucm93c1swXS51c2VyX2lkLFxuICAgICAgICB0b2tlbixcbiAgICAgIH07XG4gICAgICByZXMuc3RhdHVzKDIwMCkuanNvbihfcmVzcG9uc2Uuc3VjY2VzcyhkYXRhKSk7XG4gICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgbG9nLmVycm9yKGBCeWNyeXB0IGVycm9yICR7ZXJyfWApO1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKF9yZXNwb25zZS5lcnJvcignRmFpbGVkIHRvIGNvbXBhcmUgcGFzc3dvcmRzJykpO1xuICAgIH0pO1xuICB9KTtcbn0pLnBvc3QoJy9hZG1pbi86dXNlcl9pZCcsIGF1dGhDaGVjaywgKHJlcSwgcmVzKSA9PiB7XG4gIC8vIG1ha2UgdXNlciBhbiBhZG1pblxuICBjb25zdCB0b0JlQWRtaW4gPSByZXEucGFyYW1zLnVzZXJfaWQ7XG4gIGNvbnN0IHsgZGF0YSB9ID0gcmVxLmRlY29kZWQ7XG4gIGNvbnN0IGFkbWluID0gZGF0YS5pc19hZG1pbjtcblxuICAvLyBsb2cuaW5mbyhhZG1pbik7XG4gIGlmIChhZG1pbikge1xuICAgIGRiLnF1ZXJ5KGBTRUxFQ1QgKiBGUk9NIHVzZXJzIFdIRVJFIHVzZXJfaWQgPSAnJHt0b0JlQWRtaW59JyBBTkQgaXNfYWRtaW49JyR7ZmFsc2V9J2ApLnRoZW4oKHJlc3ApID0+IHtcbiAgICAgIGlmIChyZXNwLnJvd0NvdW50ID4gMCkge1xuICAgICAgICBkYi5xdWVyeShgVVBEQVRFIHVzZXJzIFNFVCBpc19hZG1pbj0nJHt0cnVlfScgV0hFUkUgdXNlcl9pZCA9ICcke3RvQmVBZG1pbn0nIFJFVFVSTklORyAqYCkudGhlbigobmV3QWRtaW5EYXRhKSA9PiB7XG4gICAgICAgICAgaWYgKG5ld0FkbWluRGF0YS5yb3dDb3VudCA+IDApIHtcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKF9yZXNwb25zZS5zdWNjZXNzKG5ld0FkbWluRGF0YS5yb3dzWzBdKSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKF9yZXNwb25zZS5lcnJvcignRmFpbGVkIHRvIGFzc2lnbiByb2xlJykpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSkuY2F0Y2goKCkgPT4ge1xuICAgICAgICAgIHJlcy5zdGF0dXMoNDAxKS5qc29uKF9yZXNwb25zZS5lcnJvcignT3BwcyEgU29tZXRoaW5nIHdlbnQgd3JvbmcnKSk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzLnN0YXR1cyg0MDMpLmpzb24oX3Jlc3BvbnNlLmVycm9yKCdDYW5ub3QgcmUtYXNzaWduIHJvbGUgdG8gdXNlcicpKTtcbiAgICAgIH1cbiAgICB9KS5jYXRjaCgoKSA9PiB7XG4gICAgICByZXMuc3RhdHVzKDQwMSkuanNvbihfcmVzcG9uc2UuZXJyb3IoJ09wcHMhIFNvbWV0aGluZyB3ZW50IHdyb25nJykpO1xuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIHJlcy5zdGF0dXMoNTA1KS5qc29uKF9yZXNwb25zZS5lcnJvcignWW91ciBwbGFucyBmYWlsZWQsIHdlIGhhdmUgYSBzdHJvbmdlciBhbGdvcml0aG0nKSk7XG4gIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHJvdXRlcjtcbiJdfQ==